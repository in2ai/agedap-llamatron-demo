<p-confirmdialog [baseZIndex]="10000" [style]="{ 'max-width': '600px' }"></p-confirmdialog>
<div
  class="h-full flex flex-col transition-[width] ease-in-out duration-300 p-4"
  [ngClass]="{ 'w-72': !sidebarCollapsed, 'w-32 fixed': sidebarCollapsed }"
>
  <!-- toggle button -->
  <div class="flex flex-row items-center justify-between gap-1 min-w-32 w-fit">
    <div class="flex items-center gap-2 text-white mr-10">
      <img class="w-6 h-6" src="icons/app-icon.svg" alt="Logo" />
      <h3 class="font-bold text-xl">Llamatron</h3>
    </div>
    <button
      [title]="sidebarCollapsed ? 'Abrir barra lateral' : 'Cerrar barra lateral'"
      class="cursor-pointer p-1 px-2 rounded-md hover:bg-iconHover hover:text-white"
      (click)="topggleSidebarCollapse()"
    >
      <i *ngIf="!sidebarCollapsed" class="pi pi-angle-double-left"></i>
      <i *ngIf="sidebarCollapsed" class="pi pi-angle-double-right"></i>
    </button>
    <button
      [disabled]="!modelLoaded"
      [title]="'Nuevo chat'"
      class="cursor-pointer p-1 px-2 rounded-md hover:bg-iconHover hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"
      (click)="newChat()"
    >
      <i class="pi pi-pen-to-square"></i>
    </button>
  </div>
  <h3 *ngIf="!sidebarCollapsed" class="font-bold mt-4 mb-2">Conversaciones</h3>
  <!-- Menu -->
  <div
    *ngIf="!sidebarCollapsed && chats.length > 0"
    class="flex-1 flex justify-items-center items-start my-2 pr-2 overflow-y-auto overflow-x-hidden"
  >
    <ul class="list-none m-0 flex flex-col gap-2 p-0 w-full">
      <li
        *ngFor="let chat of chats"
        class="text-mainContentText text-md flex flex-row items-center cursor-pointer rounded-md p-2 hover:bg-primaryButtonBgHover transition-colors duration-200 group"
        [ngClass]="{ 'bg-primaryButtonBgHover': this.currentChatId === chat.id }"
      >
        <i [class]="'pi mr-2 text-lg shrink-0 grow-0 ' + getChatIcon(chat)"></i>
        <div
          [class]="
            'flex flex-col ' +
            (chat.unreadMessages && chat.unreadMessages > 0
              ? 'w-[70%] group-hover:w-[70%]'
              : 'w-[90%] group-hover:w-[70%]')
          "
          (click)="selectChat(chat)"
        >
          <span class="truncate text-sm">{{ chat.name }}</span>
          <span class="text-secondaryText text-xs">{{
            chat.createdAt | date: 'dd/MM/yyyy HH:mm'
          }}</span>
        </div>
        <div
          *ngIf="chat.unreadMessages && chat.unreadMessages > 0"
          class="mx-2 w-6 h-6 shrink-0 grow-0 bg-red-500 rounded-full text-white flex items-center justify-center group-hover:hidden"
          [title]="'Mensajes no leídos: ' + chat.unreadMessages"
        >
          <span class="text-xs font-bold">{{ chat.unreadMessages }}</span>
        </div>
        <button
          class="ml-auto p-1 px-3 rounded-md z-10 cursor-pointer invisible group-hover:visible hover:bg-secondaryText hover:text-red-400"
          [title]="'Eliminar conversación'"
          (click)="deleteChat(chat)"
        >
          <i class="pi pi-trash"></i>
        </button>
      </li>
    </ul>
  </div>
  <div
    *ngIf="!sidebarCollapsed && chats.length === 0"
    class="flex-1 flex justify-items-center items-center"
  >
    <span class="text-secondaryText text-center">El historial de conversaciones está vacío.</span>
  </div>
  <div *ngIf="sidebarCollapsed" class="flex-1 flex justify-items-center items-center"></div>
  <!-- Configuration button -->
  <div *ngIf="!sidebarCollapsed" class="flex-none mb-2">
    <app-nav-link
      [isCollapsed]="sidebarCollapsed"
      [isActive]="isRouteActive(configRoute)"
      [label]="configRoute.title | translate"
      [primeIcon]="configRoute.icon"
      [routerLink]="configRoute.path"
      [queryParams]="configRoute.params"
    />
  </div>
</div>
